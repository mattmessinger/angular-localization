{"version":3,"sources":["angular-localization-mattmessinger.js"],"names":["angular","window","document","undefined","module","constant","value","en","service","$injector","$http","$q","$log","$rootScope","$window","localeConf","localeEvents","localeSupported","localeFallbacks","splitToken","tok","key","path","allowNestedJson","split","length","slice","sym","push","join","isToken","str","TOKEN_REGEX","test","getPath","result","getKey","getBundle","i","bundles","isFrozen","obj","Object","$$frozen","freeze","replaceAll","substr","sub","replace","RegExp","loadBundle","token","parent","ref","root","locale","currentLocale","url","basePath","extend","_loading","fileExtension","get","then","response","data","hasOwnProperty","$broadcast","resourceUpdates","bundle","deferrences","resolve","err","error","reject","bundleReady","langFile","defer","promise","ready","paths","deferred","outstanding","isString","isArray","Error","forEach","all","applySubstitutions","text","subs","res","firstOfKind","v","k","getLocalizedString","txt","A","isValidToken","indexOf","delimiter","fromJson","isObject","info","updateHtmlTagLangAttr","lang","$html","attr","getLanguageSupported","language","foundLanguage","languageSuppported","fallbackLang","isUndefined","defaultLocale","setLocale","trim","localeChanges","cookieStore","put","cookieName","getLocale","getPreferredBrowserLanguage","nav","navigator","browserLanguagePropertyKeys","languages","initialSetLocale","validTokens","element","body","persistSelection","has","getString","filter","i18nFilter","input","args","$stateful","directive","$sce","setText","elm","tag","html","getTrustedHtml","update","string","optArgs","scope","attrs","hasObservers","$observe","newVal","oldVal","$attr","normAttr","observableAttrs","i18n","$on","setAttr","$attrs","$set","$normalize","getUpdateText","$scope","target","lastValues","attributes","exp","values","$eval","langFiles","priority","compile","$elem","i18nAttr","updateText","sharedDictionary","this"],"mappings":"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","file":"angular-localization-mattmessinger.min.js","sourcesContent":["/*!\n * angular-localization-mattmessinger :: v1.6.0 :: 2020-08-04\n * web: http://doshprompt.github.io/angular-localization\n *\n * Copyright (c) 2020 | Rahul Doshi\n * License: MIT\n */\n;(function (angular, window, document, undefined) {\n    'use strict';\n\nangular.module('ngLocalize.Version', [])\n    .constant('localeVer', '1.6.0');\nangular.module('ngLocalize', ['ngSanitize', 'ngLocalize.Config', 'ngLocalize.Events', 'ngLocalize.InstalledLanguages']);\n\nangular.module('ngLocalize.InstalledLanguages', [])\n    .value('localeSupported', [\n        'en-US'\n    ])\n    .value('localeFallbacks', {\n        'en': 'en-US'\n    });\nangular.module('ngLocalize')\n    .service('locale', function ($injector, $http, $q, $log, $rootScope, $window, localeConf, localeEvents, localeSupported, localeFallbacks) {\n        var TOKEN_REGEX = localeConf.validTokens || new RegExp('^([\\\\w-]+\\\\/)*([\\\\w-]+\\\\.)+([\\\\w\\\\s-])+\\\\w(:.*)?$'),\n            $html = angular.element(document.body).parent(),\n            currentLocale,\n            deferrences,\n            bundles,\n            cookieStore,\n            sym = localeConf.allowNestedJson ? '/' : '.';\n\n        if (localeConf.persistSelection && $injector.has('$cookies')) {\n            cookieStore = $injector.get('$cookies');\n        }\n\n        function splitToken(tok){\n            var key, path;\n            if (localeConf.allowNestedJson){\n                var split = tok ? tok.split('.') : [];\n                key = split.length > 1 ? split.slice(1) : '';\n                path = split.length > 0 ? split[0].split(sym) : [];\n                path.push(split.length > 1 ? split[1] : '');\n            } else {\n                path = tok ? tok.split('/').join('.').split('.') : [];\n                key = path.length > 1 ? path[path.length - 1] : '';\n            }\n            return {\n                key: key,\n                path: path\n            };\n        }\n\n        function isToken(str) {\n            return (str && str.length && TOKEN_REGEX.test(str));\n        }\n\n        function getPath(tok) {\n            var path = splitToken(tok).path,\n                result = '';\n\n            if (path.length > 1) {\n                result = path.slice(0, -1).join(sym);\n            }\n\n            return result;\n        }\n\n        function getKey(tok) {\n            return splitToken(tok).key;\n        }\n\n        function getBundle(tok) {\n            var result = null,\n                path = splitToken(tok).path,\n                i;\n\n            if (path.length > 1) {\n                result = bundles;\n\n                for (i = 0; i < path.length - 1; i++) {\n                    if (result[path[i]]) {\n                        result = result[path[i]];\n                    } else {\n                        result = null;\n                        break;\n                    }\n                }\n            }\n\n            return result;\n        }\n\n        function isFrozen (obj) {\n            return (Object.isFrozen || function (obj) {\n                return obj && obj.$$frozen;\n            })(obj);\n        }\n\n        function freeze (obj) {\n            return (Object.freeze || function (obj) {\n                if (obj) {\n                    obj.$$frozen = true;\n                }\n            })(obj);\n        }\n\n        // http://stackoverflow.com/a/17606289\n        function replaceAll(str, substr, sub) {\n            return str.replace(new RegExp(substr.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'g'), sub);\n        }\n\n        function loadBundle(token) {\n            var path = splitToken(token).path,\n                root = bundles,\n                parent,\n                locale = currentLocale,\n                url = localeConf.basePath + '/' + locale,\n                ref,\n                i;\n\n            if (path.length > 1) {\n                for (i = 0; i < path.length - 1; i++) {\n                    ref = path[i];\n                    if (!root[ref]) {\n                        root[ref] = {};\n                    }\n                    parent = root;\n                    root = root[ref];\n                    url += '/' + ref;\n                }\n\n                if (isFrozen(root)) {\n                    root = angular.extend({}, root);\n                }\n                if (!root._loading) {\n                    root._loading = true;\n\n                    url += localeConf.fileExtension;\n\n                    $http.get(url)\n                        .then(function (response) {\n                            var key,\n                                path = getPath(token),\n                                data = response.data;\n                            // Merge the contents of the obtained data into the stored bundle.\n                            for (key in data) {\n                                if (data.hasOwnProperty(key)) {\n                                    root[key] = data[key];\n                                }\n                            }\n\n                            // Mark the bundle as having been \"loaded\".\n                            delete root._loading;\n                            parent[ref] = freeze(root);\n                            root = null;\n\n                            // Notify anyone who cares to know about this event.\n                            $rootScope.$broadcast(localeEvents.resourceUpdates, {\n                                locale: locale,\n                                path: path,\n                                bundle: parent[ref]\n                            });\n\n                            // If we issued a Promise for this file, resolve it now.\n                            if (deferrences[path]) {\n                                deferrences[path].resolve(path);\n                            }\n                        }, function (err) {\n                            var path = getPath(token);\n\n                            $log.error('[localizationService] Failed to load: ' + url);\n\n                            // We can try it again later.\n                            delete root._loading;\n\n                            // If we issued a Promise for this file, reject it now.\n                            if (deferrences[path]) {\n                                deferrences[path].reject(err.data);\n                            }\n                        });\n                }\n            }\n        }\n\n        function bundleReady(path) {\n            var bundle,\n                token;\n\n            path = path || localeConf.langFile;\n            token = path + '._LOOKUP_';\n            bundle = getBundle(token);\n\n            if (!deferrences[path]) {\n                deferrences[path] = $q.defer();\n            }\n\n            if (bundle && !bundle._loading) {\n                deferrences[path].resolve(path);\n            } else {\n                if (!bundle) {\n                    loadBundle(token);\n                }\n            }\n\n            return deferrences[path].promise;\n        }\n\n        function ready(path) {\n            var paths,\n                deferred,\n                outstanding;\n\n            if (angular.isString(path)) {\n                paths = path.split(',');\n            } else if (angular.isArray(path)) {\n                paths = path;\n            } else {\n                throw new Error('locale.ready requires either an Array or comma-separated list.');\n            }\n\n            if (paths.length > 1) {\n                outstanding = [];\n                paths.forEach(function (path) {\n                    outstanding.push(bundleReady(path));\n                });\n                deferred = $q.all(outstanding);\n            } else {\n                deferred = bundleReady(path);\n            }\n\n            return deferred;\n        }\n\n        function applySubstitutions(text, subs) {\n            var res = text,\n                firstOfKind = 0;\n\n            if (subs) {\n                if (angular.isArray(subs)) {\n                    angular.forEach(subs, function (sub, i) {\n                        res = replaceAll(res, '%' + (i + 1), sub);\n                        res = replaceAll(res, '{' + (i + 1) + '}', sub);\n                    });\n                } else {\n                    angular.forEach(subs, function (v, k) {\n                        ++firstOfKind;\n\n                        res = replaceAll(res, '{' + k + '}', v);\n                        res = replaceAll(res, '%' + k, v);\n                        res = replaceAll(res, '%' + (firstOfKind), v);\n                        res = replaceAll(res, '{' + (firstOfKind) + '}', v);\n                    });\n                }\n            }\n            res = res.replace(/\\n/g, '<br>');\n\n            return res;\n        }\n\n        function getLocalizedString(txt, subs) {\n            var result = '',\n                bundle,\n                key,\n                A,\n                isValidToken = false;\n\n            if (angular.isString(txt) && !subs && txt.indexOf(localeConf.delimiter) !== -1) {\n                A = txt.split(localeConf.delimiter);\n                txt = A[0];\n                subs = angular.fromJson(A[1]);\n            }\n\n            isValidToken = isToken(txt);\n            if (isValidToken) {\n                if (!angular.isObject(subs)) {\n                    subs = [subs];\n                }\n\n                bundle = getBundle(txt);\n                if (bundle && !bundle._loading) {\n                    key = getKey(txt);\n                    if (localeConf.allowNestedJson){\n                        for (var i = 0; i < key.length - 1; i++) {\n                            if (bundle[key[i]]) {\n                                bundle = bundle[key[i]];\n                            } else {\n                                bundle = null;\n                                break;\n                            }\n                        }\n                        key =  key[key.length -1];\n                    }\n                    if (bundle[key]) {\n                        if (angular.isString(bundle[key])){\n                            result = applySubstitutions(bundle[key], subs);\n                        } else {\n                            $log.info('[localizationService] Key is not a string: ' + txt + '. Is it a nested object?');\n                            result = '%%KEY_NOT_STRING%%';\n                        }\n                    } else {\n                        $log.info('[localizationService] Key not found: ' + txt);\n                        result = '%%KEY_NOT_FOUND%%';\n                    }\n                } else {\n                    if (!bundle) {\n                        loadBundle(txt);\n                    }\n                }\n            } else {\n                result = txt;\n            }\n\n            return result;\n        }\n\n        function updateHtmlTagLangAttr(lang) {\n            lang = lang.split('-')[0];\n\n            $html.attr('lang', lang);\n        }\n\n        function getLanguageSupported(language) {\n            var foundLanguage = null;\n            if (language && language.length) {\n                localeSupported.forEach(function (languageSuppported) {\n                    if (languageSuppported.indexOf(language) === 0) {\n                        foundLanguage = languageSuppported;\n                        return;\n                    }\n                });\n                if (!foundLanguage) {\n                    var fallbackLang = localeFallbacks[language.split('-')[0]];\n                    if (!angular.isUndefined(fallbackLang)) {\n                      foundLanguage = fallbackLang;\n                    }\n                }\n            }\n            return foundLanguage || localeConf.defaultLocale;\n        }\n\n        function setLocale(value) {\n            var lang;\n\n            if (angular.isString(value) && value.length ) {\n                value = value.trim();\n                lang = getLanguageSupported(value);\n            } else {\n                lang = localeConf.defaultLocale;\n            }\n\n            if (lang !== currentLocale) {\n                bundles = {};\n                deferrences = {};\n                currentLocale = lang;\n\n                updateHtmlTagLangAttr(lang);\n\n                $rootScope.$broadcast(localeEvents.localeChanges, currentLocale);\n\n                if (cookieStore) {\n                    cookieStore.put(localeConf.cookieName, lang);\n                }\n            }\n        }\n\n        function getLocale() {\n            return currentLocale;\n        }\n\n        function getPreferredBrowserLanguage() {\n            var nav = $window.navigator,\n                browserLanguagePropertyKeys = ['language', 'browserLanguage', 'systemLanguage', 'userLanguage'],\n                i,\n                language;\n\n            // support for HTML 5.1 \"navigator.languages\"\n            if (angular.isArray(nav.languages)) {\n                for (i = 0; i < nav.languages.length; i++) {\n                    language = nav.languages[i];\n                    if (language) {\n                        return language;\n                    }\n                }\n            }\n            // support for other well known properties in browsers\n            for (i = 0; i < browserLanguagePropertyKeys.length; i++) {\n                language = nav[browserLanguagePropertyKeys[i]];\n                if (language) {\n                    return language;\n                }\n            }\n\n            return null;\n        }\n\n        function initialSetLocale() {\n            setLocale(cookieStore && cookieStore.get(localeConf.cookieName) ?\n                cookieStore.get(localeConf.cookieName) :\n                getPreferredBrowserLanguage());\n        }\n\n        initialSetLocale();\n\n        return {\n            ready: ready,\n            isToken: isToken,\n            getPath: getPath,\n            getKey: getKey,\n            setLocale: setLocale,\n            getLocale: getLocale,\n            getString: getLocalizedString,\n            getPreferredBrowserLanguage: getPreferredBrowserLanguage\n        };\n    });\n\nangular.module('ngLocalize')\n    .filter('i18n', function (locale) {\n        var i18nFilter = function (input, args) {\n            return locale.getString(input, args);\n        };\n\n        i18nFilter.$stateful = true;\n\n        return i18nFilter;\n    });\n\nangular.module('ngLocalize.Events', [])\n    .constant('localeEvents', {\n        resourceUpdates: 'ngLocalizeResourcesUpdated',\n        localeChanges: 'ngLocalizeLocaleChanged'\n    });\nangular.module('ngLocalize')\n    .directive('i18n', function ($sce, locale, localeEvents, localeConf) {\n        function setText(elm, tag) {\n            if (tag !== elm.html()) {\n                elm.html($sce.getTrustedHtml(tag));\n            }\n        }\n\n        function update(elm, string, optArgs) {\n            if (locale.isToken(string)) {\n                locale.ready(locale.getPath(string)).then(function () {\n                    setText(elm, locale.getString(string, optArgs));\n                });\n            } else {\n                setText(elm, string);\n            }\n        }\n\n        return function (scope, elm, attrs) {\n            var hasObservers;\n\n            attrs.$observe('i18n', function (newVal, oldVal) {\n                if (newVal && newVal !== oldVal) {\n                    update(elm, newVal, hasObservers);\n                }\n            });\n\n            angular.forEach(attrs.$attr, function (attr, normAttr) {\n                if (localeConf.observableAttrs.test(attr)) {\n                    attrs.$observe(normAttr, function (newVal) {\n                        if (newVal || !hasObservers || !hasObservers[normAttr]) {\n                            hasObservers = hasObservers || {};\n                            hasObservers[normAttr] = attrs[normAttr];\n                            update(elm, attrs.i18n, hasObservers);\n                        }\n                    });\n                }\n            });\n\n            scope.$on(localeEvents.resourceUpdates, function () {\n                update(elm, attrs.i18n, hasObservers);\n            });\n            scope.$on(localeEvents.localeChanges, function () {\n                update(elm, attrs.i18n, hasObservers);\n            });\n        };\n    })\n    .directive('i18nAttr', function ($rootScope, locale, localeEvents) {\n        function setAttr ($attrs, key, value) {\n            $attrs.$set($attrs.$normalize(key), value);\n        }\n\n        function getUpdateText ($scope, target, $attrs) {\n            var lastValues = {};\n            return function (attributes) {\n                var values = $scope.$eval(attributes),\n                    langFiles = [],\n                    exp;\n\n                for(var key in values) {\n                    exp = values[key];\n                    if (locale.isToken(exp) && langFiles.indexOf(locale.getPath(exp)) === -1) {\n                        langFiles.push(locale.getPath(exp));\n                    }\n                }\n\n                locale.ready(langFiles).then(function () {\n                    var value = '';\n                    for(var key in values) {\n                        exp = values[key];\n                        value = locale.getString(exp);\n                        if (lastValues[key] !== value) {\n                            lastValues[key] = value;\n                            setAttr($attrs, key, value);\n                        }\n                    }\n                });\n            };\n        }\n\n        return {\n            // ensure has higher priority than ngAria\n            priority: 1000,\n            compile: function ($elem, $attrs) {\n                angular.forEach($rootScope.$eval($attrs.i18nAttr), function (value, key) {\n                    // temporarily populate attribute\n                    // avoid false positive warning about aria-label\n                    setAttr($attrs, key, value || '...');\n                });\n\n                return function ($scope, $elem, $attrs) {\n                    var updateText = getUpdateText($scope, $elem, $attrs);\n\n                    $attrs.$observe('i18nAttr', function (newVal) {\n                        if (newVal) {\n                            updateText(newVal);\n                        }\n                    });\n\n                    $scope.$on(localeEvents.resourceUpdates, function () {\n                        updateText($attrs.i18nAttr);\n                    });\n\n                    $scope.$on(localeEvents.localeChanges, function () {\n                        updateText($attrs.i18nAttr);\n                    });\n                };\n            }\n        };\n    });\n\nangular.module('ngLocalize.Config', [])\n    .value('localeConf', {\n        basePath: 'languages',\n        defaultLocale: 'en-US',\n        sharedDictionary: 'common',\n        fileExtension: '.lang.json',\n        persistSelection: true,\n        cookieName: 'COOKIE_LOCALE_LANG',\n        observableAttrs: new RegExp('^data-(?!ng-|i18n)'),\n        delimiter: '::',\n        validTokens: new RegExp('^([\\\\w-]+\\\\/)*([\\\\w-]+\\\\.)+([\\\\w\\\\s-])+\\\\w(:.*)?$'),\n        allowNestedJson: false\n    });\n\n}(this.angular, this, this.document));\n"]}